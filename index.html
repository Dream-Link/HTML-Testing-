<!DOCTYPE html>
<html lang="hi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Modern HTML Tester</title>

    <style>
        /* CSS Variables for Theming (Light & Dark Mode) */
        :root {
            --bg-color: #f0f2f5;
            --container-bg: #ffffff;
            --text-color: #212529;
            --subtle-text-color: #6c757d;
            --border-color: #dee2e6;
            --primary-color: #0d6efd;
            --primary-hover: #0b5ed7;
            --danger-color: #dc3545;
            --success-color: #198754;
            --secondary-color: #6c757d;
            --editor-bg: #f8f9fa;
            --shadow-color: rgba(0, 0, 0, 0.075);
        }

        body.dark-mode {
            --bg-color: #121212;
            --container-bg: #1e1e1e;
            --text-color: #e0e0e0;
            --subtle-text-color: #a0a0a0;
            --border-color: #444;
            --primary-color: #3b82f6;
            --primary-hover: #2563eb;
            --danger-color: #f87171;
            --success-color: #4ade80;
            --secondary-color: #9ca3af;
            --editor-bg: #2a2a2a;
            --shadow-color: rgba(0, 0, 0, 0.2);
        }

        /* General Layout & Font */
        * {
            box-sizing: border-box;
            margin: 0;
            padding: 0;
        }

        html, body {
            height: 100%;
        }

        body {
            font-family: system-ui, -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, sans-serif;
            background-color: var(--bg-color);
            color: var(--text-color);
            display: flex;
            flex-direction: column;
            transition: background-color 0.3s, color 0.3s;
        }

        /* Main container takes all height */
        .container {
            display: flex;
            flex-direction: column;
            height: 100%;
            padding: 1rem 1.5rem;
            gap: 1rem;
        }
        
        /* Header */
        .header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            flex-shrink: 0;
        }
        
        .header h1 {
            font-size: 1.5rem;
        }

        #theme-toggle {
            cursor: pointer;
            background: none;
            border: 1px solid var(--border-color);
            border-radius: 50%;
            width: 36px;
            height: 36px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.2rem;
            color: var(--text-color);
        }

        /* Editor takes most of the space */
        .editor-wrapper {
            flex-grow: 1;
            display: flex;
            flex-direction: column;
            gap: 0.75rem;
            border: 1px solid var(--border-color);
            border-radius: 8px;
            background-color: var(--container-bg);
            box-shadow: 0 4px 12px var(--shadow-color);
            padding: 0.75rem;
            min-height: 250px; /* Minimum height for small screens */
        }
        
        .button-group {
            display: flex;
            gap: 0.5rem;
            flex-wrap: wrap;
        }
        
        .button-group button {
            padding: 0.5rem 1rem;
            border: none;
            border-radius: 6px;
            font-weight: 500;
            cursor: pointer;
            color: white;
            transition: background-color 0.2s;
        }
        
        #pasteBtn { background-color: var(--success-color); }
        #testBtn { background-color: var(--primary-color); }
        #saveBtn { background-color: var(--secondary-color); }
        
        #pasteBtn:hover, #testBtn:hover, #saveBtn:hover {
            filter: brightness(1.1);
        }
        
        #htmlCode {
            flex-grow: 1;
            width: 100%;
            border: none;
            padding: 0.75rem;
            font-family: "SF Mono", "Consolas", "Menlo", monospace;
            font-size: 1rem;
            line-height: 1.5;
            background-color: var(--editor-bg);
            color: var(--text-color);
            border-radius: 6px;
            resize: none;
        }
        
        #htmlCode:focus {
            outline: 2px solid var(--primary-color);
        }
        
        /* History Section */
        .history-container {
            flex-shrink: 0; /* Prevents history from growing too tall */
            max-height: 30vh; /* Max 30% of viewport height */
            overflow-y: auto;
        }

        .history-container h2 {
            font-size: 1.2rem;
            margin-bottom: 0.75rem;
            color: var(--subtle-text-color);
        }

        .history-item {
            display: flex;
            align-items: center;
            gap: 1rem;
            padding: 0.75rem;
            background-color: var(--container-bg);
            border-radius: 6px;
            margin-bottom: 0.5rem;
            border-left: 3px solid var(--border-color);
            transition: border-color 0.3s;
        }

        .history-item:hover {
            border-left-color: var(--primary-color);
        }

        .history-preview {
            flex-grow: 1;
            white-space: nowrap;
            overflow: hidden;
            text-overflow: ellipsis;
            font-family: monospace;
            font-size: 0.9rem;
            color: var(--subtle-text-color);
        }
        
        .history-actions {
            display: flex;
            gap: 0.5rem;
        }

        .history-actions button {
            background: none;
            border: none;
            cursor: pointer;
            font-size: 1.1rem;
            color: var(--subtle-text-color);
            padding: 4px;
            border-radius: 4px;
            transition: color 0.2s, background-color 0.2s;
        }
        .history-actions button:hover {
            color: var(--text-color);
            background-color: var(--bg-color);
        }
    </style>
</head>

<body>

    <div class="container">

        <header class="header">
            <h1>HTML Live Tester</h1>
            <button id="theme-toggle" title="Toggle Dark/Light Mode">‚òÄÔ∏è</button>
        </header>

        <div class="editor-wrapper">
            <div class="button-group">
                <button id="pasteBtn">üìã Paste</button>
                <button id="testBtn">üöÄ Test</button>
                <button id="saveBtn">üíæ Save File</button>
            </div>
            <textarea id="htmlCode" placeholder="Paste your HTML code here..."></textarea>
        </div>

        <div class="history-container">
            <h2>üìú History</h2>
            <div id="historyList">
                </div>
        </div>

    </div>

    <script>
        document.addEventListener('DOMContentLoaded', () => {
            // DOM Elements
            const htmlCodeTextarea = document.getElementById('htmlCode');
            const pasteBtn = document.getElementById('pasteBtn');
            const testBtn = document.getElementById('testBtn');
            const saveBtn = document.getElementById('saveBtn');
            const historyList = document.getElementById('historyList');
            const themeToggle = document.getElementById('theme-toggle');

            // --- THEME ---
            // Check for saved theme in localStorage
            if (localStorage.getItem('theme') === 'dark') {
                document.body.classList.add('dark-mode');
                themeToggle.innerHTML = 'üåô';
            }

            themeToggle.addEventListener('click', () => {
                document.body.classList.toggle('dark-mode');
                if (document.body.classList.contains('dark-mode')) {
                    localStorage.setItem('theme', 'dark');
                    themeToggle.innerHTML = 'üåô';
                } else {
                    localStorage.setItem('theme', 'light');
                    themeToggle.innerHTML = '‚òÄÔ∏è';
                }
            });

            // --- EDITOR ACTIONS ---
            pasteBtn.addEventListener('click', async () => {
                try {
                    const text = await navigator.clipboard.readText();
                    htmlCodeTextarea.value = text;
                } catch (err) {
                    alert('Clipboard access denied. Please paste manually.');
                }
            });

            testBtn.addEventListener('click', () => {
                const code = htmlCodeTextarea.value;
                if (!code.trim()) {
                    alert('Editor is empty. Nothing to test.');
                    return;
                }
                const newWindow = window.open();
                newWindow.document.write(code);
                newWindow.document.close();
                addToHistory(code);
            });

            saveBtn.addEventListener('click', () => {
                downloadCode(htmlCodeTextarea.value, 'code.html');
            });

            function downloadCode(code, filename) {
                if (!code.trim()) {
                    alert('Editor is empty. Nothing to save.');
                    return;
                }
                const blob = new Blob([code], { type: 'text/html' });
                const url = URL.createObjectURL(blob);
                const a = document.createElement('a');
                a.href = url;
                a.download = filename;
                a.click();
                URL.revokeObjectURL(url);
            }

            // --- HISTORY LOGIC ---
            historyList.addEventListener('click', handleHistoryAction);

            function getHistory() {
                return JSON.parse(localStorage.getItem('htmlTesterHistory')) || [];
            }

            function saveHistory(history) {
                localStorage.setItem('htmlTesterHistory', JSON.stringify(history));
            }

            function addToHistory(code) {
                const history = getHistory();
                const newEntry = {
                    id: Date.now(),
                    code: code,
                    date: new Date().toLocaleString()
                };
                history.unshift(newEntry);
                if (history.length > 20) history.pop(); // Limit history to 20 items
                saveHistory(history);
                renderHistory();
            }

            function renderHistory() {
                const history = getHistory();
                historyList.innerHTML = '';
                if (history.length === 0) {
                    historyList.innerHTML = '<p style="color: var(--subtle-text-color);">Your test history will appear here.</p>';
                    return;
                }
                history.forEach(item => {
                    const el = document.createElement('div');
                    el.className = 'history-item';
                    el.dataset.id = item.id;
                    const previewText = item.code.trim().replace(/</g, "&lt;");

                    el.innerHTML = `
                        <div class="history-preview" title="${previewText}\n\nSaved on: ${item.date}">${previewText}</div>
                        <div class="history-actions">
                            <button class="action-btn-preview" title="Preview">üöÄ</button>
                            <button class="action-btn-edit" title="Edit">‚úèÔ∏è</button>
                            <button class="action-btn-download" title="Download">üíæ</button>
                            <button class="action-btn-delete" title="Delete">üóëÔ∏è</button>
                        </div>
                    `;
                    historyList.appendChild(el);
                });
            }

            function handleHistoryAction(e) {
                const button = e.target.closest('button');
                if (!button) return;

                const itemEl = button.closest('.history-item');
                const id = Number(itemEl.dataset.id);
                const history = getHistory();
                const item = history.find(i => i.id === id);
                if (!item) return;

                if (button.classList.contains('action-btn-preview')) {
                    const newWindow = window.open();
                    newWindow.document.write(item.code);
                    newWindow.document.close();
                } else if (button.classList.contains('action-btn-edit')) {
                    htmlCodeTextarea.value = item.code;
                    htmlCodeTextarea.focus();
                } else if (button.classList.contains('action-btn-download')) {
                    downloadCode(item.code, `snippet-${item.id}.html`);
                } else if (button.classList.contains('action-btn-delete')) {
                    if (confirm('Are you sure you want to delete this item?')) {
                        const updatedHistory = history.filter(i => i.id !== id);
                        saveHistory(updatedHistory);
                        renderHistory();
                    }
                }
            }

            // Initial Load
            renderHistory();
        });
    </script>

</body>
</html>