<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Pro HTML Playground</title>
    
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.min.css">
    
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.15/codemirror.min.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.15/theme/material-darker.min.css">
    
    <script src="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.15/codemirror.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.15/addon/edit/closetag.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.15/mode/xml/xml.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.15/mode/javascript/javascript.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.15/mode/css/css.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.15/mode/htmlmixed/htmlmixed.min.js"></script>
    
    <script src="https://cdnjs.cloudflare.com/ajax/libs/js-beautify/1.14.9/beautify.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/js-beautify/1.14.9/beautify-css.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/js-beautify/1.14.9/beautify-html.min.js"></script>

    <script src="https://cdnjs.cloudflare.com/ajax/libs/jszip/3.10.1/jszip.min.js"></script>

    <script src="https://cdnjs.cloudflare.com/ajax/libs/split.js/1.6.0/split.min.js"></script>

    <style>
        :root {
            --bg-color: #f0f2f5;
            --panel-bg: #ffffff;
            --text-color: #333;
            --border-color: #e0e0e0;
            --primary-color: #007bff;
            --hover-color: #0056b3;
            --shadow: 0 1px 4px rgba(0,0,0,0.07);
            --font-size-base: 13px; /* Compact font size */
        }
        
        .dark-mode {
            --bg-color: #1a1a2e;
            --panel-bg: #24293e;
            --text-color: #e0e0e0;
            --border-color: #3a3f58;
            --primary-color: #1e90ff;
            --hover-color: #1c7ed6;
        }

        * { box-sizing: border-box; }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Helvetica, Arial, sans-serif;
            font-size: var(--font-size-base);
            margin: 0;
            background-color: var(--bg-color);
            color: var(--text-color);
            display: flex;
            flex-direction: column;
            height: 100vh;
            overflow: hidden;
            transition: background-color 0.3s, color 0.3s;
        }

        .header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 6px 15px; /* Compact padding */
            background-color: var(--panel-bg);
            border-bottom: 1px solid var(--border-color);
            flex-shrink: 0;
        }
        
        .header h1 { margin: 0; font-size: 1.3em; }
        .dark-mode-toggle { display: flex; align-items: center; gap: 8px; }

        .toggle-switch { position: relative; display: inline-block; width: 44px; height: 24px; }
        .toggle-switch input { opacity: 0; width: 0; height: 0; }
        .slider { position: absolute; cursor: pointer; top: 0; left: 0; right: 0; bottom: 0; background-color: #ccc; transition: .4s; border-radius: 24px; }
        .slider:before { position: absolute; content: ""; height: 18px; width: 18px; left: 3px; bottom: 3px; background-color: white; transition: .4s; border-radius: 50%; }
        input:checked + .slider { background-color: var(--primary-color); }
        input:checked + .slider:before { transform: translateX(20px); }

        .main-container { display: flex; flex-grow: 1; overflow: hidden; }
        .panel { display: flex; flex-direction: column; height: 100%; overflow: hidden; }
        
        .tabs, .preview-toolbar { display: flex; background-color: var(--bg-color); padding: 4px; gap: 4px; flex-shrink: 0; }
        .tab-btn, button.btn { padding: 6px 12px; border: none; cursor: pointer; background-color: transparent; color: var(--text-color); border-radius: 4px; transition: background-color 0.2s, color 0.2s; }
        .tab-btn.active { background-color: var(--primary-color); color: white; }
        .tab-btn:hover:not(.active) { background-color: var(--border-color); }
        
        .editor-wrapper { flex-grow: 1; position: relative; }
        .CodeMirror { position: absolute; top:0; left:0; width: 100%; height: 100%; font-size: 15px; }
        .dark-mode .CodeMirror { background-color: #24293e; }

        .action-buttons { display: flex; flex-wrap: wrap; gap: 8px; padding: 8px; background-color: var(--panel-bg); border-top: 1px solid var(--border-color); }
        .action-buttons .btn { background-color: var(--primary-color); color: white; flex: 1 1 auto; border-radius: 4px; }
        .action-buttons .btn:hover { background-color: var(--hover-color); }

        .dropdown { position: relative; display: inline-block; flex: 1 1 auto; }
        .dropdown-content { display: none; position: absolute; background-color: var(--panel-bg); min-width: 140px; box-shadow: var(--shadow); z-index: 100; border-radius: 4px; border: 1px solid var(--border-color); bottom: 100%; margin-bottom: 5px; }
        .dropdown-content a { color: var(--text-color); padding: 8px 12px; text-decoration: none; display: block; }
        .dropdown-content a:hover { background-color: var(--bg-color); }
        .dropdown.show .dropdown-content { display: block; }

        #historySection { background-color: var(--panel-bg); border-top: 1px solid var(--border-color); display: flex; flex-direction: column; max-height: 35%; min-height: 150px; }
        #historySection h2 { padding: 0 12px; margin: 8px 0; font-size: 1em; }
        #historySearch { margin: 0 12px 8px; padding: 6px; border: 1px solid var(--border-color); border-radius: 4px; background-color: var(--bg-color); color: var(--text-color); }
        #historyList { list-style: none; padding: 0 12px 12px; margin: 0; overflow-y: auto; display: flex; flex-direction: column; gap: 6px; }
        .history-item { display: flex; align-items: center; justify-content: space-between; padding: 6px 8px; background-color: var(--bg-color); border: 1px solid var(--border-color); border-radius: 4px; }
        .history-item span { flex-grow: 1; cursor: pointer; white-space: nowrap; overflow: hidden; text-overflow: ellipsis; }
        .history-item .remove-btn { padding: 1px 7px; font-size: 0.8em; background-color: #dc3545; color: white; border-radius: 50%; }
        
        .preview-toolbar button { background-color: var(--panel-bg); border: 1px solid var(--border-color); }
        .preview-toolbar button.active { background-color: var(--primary-color); color: white; border-color: var(--primary-color); }
        .preview-container { display: flex; flex-direction: column; flex-grow: 1; overflow: hidden; height: 100%; }
        #previewFrame, #console-output { width: 100%; background-color: white; border: none; }
        #console-output { min-height: 50px; background-color: #2b2b2b; color: #f1f1f1; overflow-y: auto; padding: 8px; font-family: monospace; font-size: 12px; }
        #console-output .log-error { color: #ff7b7b; }
        
        /* Splitter CSS */
        .gutter { background-color: var(--bg-color); }
        .gutter.gutter-horizontal { cursor: col-resize; background-image: url('data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHZpZXdCb3g9IjAgMCA0IDE2Ij48cGF0aCBmaWxsPSIjODg4IiBkPSJNMCAxNEgydjJIMFptMC00SDJ2MkgwWm0wLTRIMnYySDBaTTQgMTRI NnYySDRabTAtNEg2djJINFptMC00SDZ2Mkg0WiIvPjwvc3ZnPg=='); }
        .gutter.gutter-vertical { cursor: row-resize; background-image: url('data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHZpZXdCb3g9IjAgMCAxNiA0Ij48cGF0aCBmaWxsPSIjODg4IiBkPSJNMiAwVjJIMFY0aDJWMkgyek02IDBWMkg0VjRoMlYySDZ6TTEwIDBWMkg4VjRoMlYySDEwek0xNCAwVjJIMTJWNBoMlYySDE0eiIvPjwvc3ZnPg=='); }

        @media (max-width: 768px) {
            .main-container, .preview-container { flex-direction: column; }
            .panel { width: 100% !important; height: 50vh; }
            .gutter.gutter-horizontal, .gutter.gutter-vertical { display: none; }
        }
    </style>
</head>
<body>
    <header class="header">
        <h1><i class="fas fa-code"></i> Playground</h1>
        <div class="dark-mode-toggle">
            <i class="fas fa-sun"></i>
            <label class="toggle-switch">
                 <input type="checkbox" id="darkModeToggle">
                 <span class="slider"></span>
            </label>
            <i class="fas fa-moon"></i>
        </div>
    </header>

    <main class="main-container" id="main-container">
        <div class="panel" id="panel-left">
            <div class="tabs">
                <button class="tab-btn active" id="html-tab" data-editor="html">HTML</button>
                <button class="tab-btn" id="css-tab" data-editor="css">CSS</button>
                <button class="tab-btn" id="js-tab" data-editor="js">JavaScript</button>
            </div>
            <div class="editor-wrapper">
                <div id="htmlEditor"></div>
                <div id="cssEditor" style="display:none;"></div>
                <div id="jsEditor" style="display:none;"></div>
            </div>
            <div class="action-buttons">
                 <button id="uploadBtn" class="btn"><i class="fas fa-upload"></i> Upload</button>
                <div class="dropdown">
                    <button class="btn" data-dropdown-btn>Templates <i class="fas fa-caret-up"></i></button>
                    <div class="dropdown-content">
                        <a href="#" id="basicHtmlTemplate">Basic HTML5</a>
                        <a href="#" id="bootstrapTemplate">Bootstrap 5</a>
                    </div>
                </div>
                <button id="formatBtn" class="btn"><i class="fas fa-align-left"></i> Format</button>
                <button id="saveBtn" class="btn"><i class="fas fa-save"></i> Save</button>
                <div class="dropdown">
                    <button class="btn" data-dropdown-btn>Download <i class="fas fa-caret-up"></i></button>
                    <div class="dropdown-content">
                        <a href="#" id="downloadHtml">.html</a>
                        <a href="#" id="downloadCss">.css</a>
                        <a href="#" id="downloadJs">.js</a>
                        <a href="#" id="downloadZip">All (.zip)</a>
                    </div>
                </div>
            </div>
            <div id="historySection">
                <h2><i class="fas fa-history"></i> History</h2>
                <input type="search" id="historySearch" placeholder="Search history...">
                <ul id="historyList"></ul>
            </div>
        </div>

        <div class="panel" id="panel-right">
            <div class="preview-toolbar">
                <button data-size="100%" class="active" title="Desktop"><i class="fas fa-desktop"></i></button>
                <button data-size="768px" title="Tablet"><i class="fas fa-tablet-alt"></i></button>
                <button data-size="375px" title="Mobile"><i class="fas fa-mobile-alt"></i></button>
            </div>
            <div class="preview-container" id="preview-container">
                <iframe id="previewFrame" title="Live Preview"></iframe>
                <div id="console-output"></div>
            </div>
        </div>
    </main>

    <input type="file" id="fileUploader" style="display: none;" accept=".html,.css,.js">

    <script>
    document.addEventListener('DOMContentLoaded', () => {
        // --- Elements ---
        const tabBtns = document.querySelectorAll('.tab-btn');
        const editorWrappers = { html: document.getElementById('htmlEditor'), css: document.getElementById('cssEditor'), js: document.getElementById('jsEditor') };
        const darkModeToggle = document.getElementById('darkModeToggle');
        const historyList = document.getElementById('historyList');
        const previewFrame = document.getElementById('previewFrame');
        const consoleOutput = document.getElementById('console-output');
        const uploadBtn = document.getElementById('uploadBtn');
        const fileUploader = document.getElementById('fileUploader');

        // --- State ---
        let activeEditor = 'html';
        let editors = {};

        // --- Editor Initialization ---
        const createEditor = (element, mode) => CodeMirror(element, { lineNumbers: true, mode, theme: 'material-darker', lineWrapping: true, autoCloseTags: true });
        editors.html = createEditor(editorWrappers.html, 'htmlmixed');
        editors.css = createEditor(editorWrappers.css, 'css');
        editors.js = createEditor(editorWrappers.js, 'javascript');

        // --- Resizable Panes ---
        Split(['#panel-left', '#panel-right'], { sizes: [50, 50], minSize: 250, gutterSize: 8, cursor: 'col-resize', onDrag: () => Object.values(editors).forEach(editor => editor.refresh()) });
        Split(['#previewFrame', '#console-output'], { direction: 'vertical', sizes: [70, 30], minSize: 50, gutterSize: 8, cursor: 'row-resize' });

        // Debounce for performance
        const debounce = (func, delay) => { let timeout; return (...args) => { clearTimeout(timeout); timeout = setTimeout(() => func.apply(this, args), delay); }; };

        // --- Core Functions ---
        const updatePreview = () => {
            const source = `<!DOCTYPE html><html><head><style>${editors.css.getValue()}<\/style></head><body>${editors.html.getValue()}<script>const _log=(type,args)=>window.parent.postMessage({type:'log',logType:type,message:args.map(arg=>JSON.stringify(arg)).join(' ')},'*');window.console={log:(...args)=>_log('log',args),error:(...args)=>_log('error',args),warn:(...args)=>_log('warn',args)};window.onerror=message=>_log('error',[message]);<\/script><script>${editors.js.getValue()}<\/script></body></html>`;
            previewFrame.srcdoc = source;
        };
        const debouncedUpdate = debounce(updatePreview, 500);
        Object.values(editors).forEach(editor => editor.on('change', debouncedUpdate));
        window.addEventListener('message', (event) => {
            if (event.source !== previewFrame.contentWindow || event.data.type !== 'log') return;
            const logEntry = document.createElement('div');
            logEntry.textContent = `> ${event.data.message}`;
            if (event.data.logType === 'error') logEntry.className = 'log-error';
            consoleOutput.appendChild(logEntry);
            consoleOutput.scrollTop = consoleOutput.scrollHeight;
        });

        // --- UI Event Handlers ---
        const switchTab = (editorName) => {
            document.getElementById(`${activeEditor}-tab`).classList.remove('active');
            editorWrappers[activeEditor].style.display = 'none';
            activeEditor = editorName;
            editorWrappers[activeEditor].style.display = 'block';
            document.getElementById(`${activeEditor}-tab`).classList.add('active');
            editors[activeEditor].refresh();
        };
        tabBtns.forEach(btn => btn.addEventListener('click', () => switchTab(btn.dataset.editor)));

        const applyDarkMode = (isDark) => {
            document.body.classList.toggle('dark-mode', isDark);
            Object.values(editors).forEach(editor => editor.setOption('theme', isDark ? 'material-darker' : 'default'));
            localStorage.setItem('darkMode', isDark);
        };
        darkModeToggle.addEventListener('change', (e) => applyDarkMode(e.target.checked));
        const isDarkModeDefault = localStorage.getItem('darkMode') !== 'false';
        darkModeToggle.checked = isDarkModeDefault;
        applyDarkMode(isDarkModeDefault);

        document.querySelector('.preview-toolbar').addEventListener('click', (e) => {
            const target = e.target.closest('button[data-size]');
            if (target) {
                previewFrame.style.width = target.dataset.size;
                document.querySelectorAll('.preview-toolbar button').forEach(b => b.classList.remove('active'));
                target.classList.add('active');
            }
        });
        
        document.addEventListener('click', e => {
            const isDropdownButton = e.target.matches("[data-dropdown-btn]");
            if (!isDropdownButton && e.target.closest('.dropdown') != null) return;
            let currentDropdown;
            if (isDropdownButton) { currentDropdown = e.target.closest('.dropdown'); currentDropdown.classList.toggle('show'); }
            document.querySelectorAll(".dropdown.show").forEach(dropdown => { if (dropdown !== currentDropdown) dropdown.classList.remove('show'); });
        });

        document.getElementById('formatBtn').addEventListener('click', () => {
            const formatters = { html: html_beautify, css: css_beautify, js: js_beautify };
            if (formatters[activeEditor]) editors[activeEditor].setValue(formatters[activeEditor](editors[activeEditor].getValue()));
        });

        // --- File Upload ---
        uploadBtn.addEventListener('click', () => fileUploader.click());
        fileUploader.addEventListener('change', (e) => {
            const file = e.target.files[0];
            if (!file) return;
            const reader = new FileReader();
            reader.onload = (event) => {
                const content = event.target.result;
                const extension = file.name.split('.').pop().toLowerCase();
                const typeMap = { html: 'html', htm: 'html', css: 'css', js: 'js' };
                const editorType = typeMap[extension];
                if (editorType) { editors[editorType].setValue(content); switchTab(editorType); } 
                else { alert('Unsupported file type. Please upload HTML, CSS, or JS files.'); }
            };
            reader.readAsText(file);
            e.target.value = null;
        });

        // --- History Management ---
        const saveCode = () => {
            const htmlContent = editors.html.getValue();
            const titleMatch = htmlContent.match(/<title\s*>\s*(.*?)\s*<\/title>/i);
            const title = (titleMatch && titleMatch[1] && titleMatch[1].trim()) ? titleMatch[1].trim() : 'Untitled';
            
            let history = JSON.parse(localStorage.getItem('codeHistory')) || [];
            history.unshift({ id: Date.now(), title, html: htmlContent, css: editors.css.getValue(), js: editors.js.getValue() });
            localStorage.setItem('codeHistory', JSON.stringify(history.slice(0, 20)));
            loadHistory();
        };
        const loadHistory = () => {
            let history = JSON.parse(localStorage.getItem('codeHistory')) || [];
            historyList.innerHTML = history.map(item => `<li class="history-item"><span data-id="${item.id}">${item.title}</span><button title="Remove" class="remove-btn" data-id="${item.id}"><i class="fas fa-trash-alt"></i></button></li>`).join('');
        };
        historyList.addEventListener('click', (e) => {
            const target = e.target.closest('[data-id]');
            if (!target) return;
            const id = target.dataset.id;
            let history = JSON.parse(localStorage.getItem('codeHistory')) || [];
            if (target.matches('.remove-btn')) {
                localStorage.setItem('codeHistory', JSON.stringify(history.filter(item => item.id != id)));
                loadHistory();
            } else if (target.matches('span')) {
                const snippet = history.find(item => item.id == id);
                if (snippet) loadTemplate(snippet.html, snippet.css, snippet.js);
            }
        });
        document.getElementById('saveBtn').addEventListener('click', saveCode);
        document.getElementById('historySearch').addEventListener('input', (e) => {
            const searchTerm = e.target.value.toLowerCase();
            document.querySelectorAll('#historyList li').forEach(item => item.style.display = item.textContent.toLowerCase().includes(searchTerm) ? 'flex' : 'none');
        });

        // --- Download & Template Functions ---
        const downloadFile = (filename, content) => { const a = document.createElement('a'); a.href = URL.createObjectURL(new Blob([content])); a.download = filename; a.click(); URL.revokeObjectURL(a.href); };
        document.getElementById('downloadHtml').addEventListener('click', () => downloadFile('index.html', editors.html.getValue()));
        document.getElementById('downloadCss').addEventListener('click', () => downloadFile('style.css', editors.css.getValue()));
        document.getElementById('downloadJs').addEventListener('click', () => downloadFile('script.js', editors.js.getValue()));
        document.getElementById('downloadZip').addEventListener('click', () => {
            const zip = new JSZip();
            zip.file("index.html", editors.html.getValue()); zip.file("style.css", editors.css.getValue()); zip.file("script.js", editors.js.getValue());
            zip.generateAsync({ type: "blob" }).then(content => downloadFile("project.zip", content));
        });
        const loadTemplate = (html = '', css = '', js = '') => { editors.html.setValue(html); editors.css.setValue(css); editors.js.setValue(js); };
        document.getElementById('basicHtmlTemplate').addEventListener('click', (e) => { e.preventDefault(); loadTemplate('<!DOCTYPE html>\n<html>\n<head>\n  <title>My Page</title>\n</head>\n<body>\n  <h1>Hello World</h1>\n</body>\n</html>', 'body { font-family: sans-serif; }', "console.log('Hello!');"); });
        document.getElementById('bootstrapTemplate').addEventListener('click', (e) => { e.preventDefault(); loadTemplate('<!doctype html>\n<html lang="en">\n  <head>\n    <meta charset="utf-8">\n    <meta name="viewport" content="width=device-width, initial-scale=1">\n    <title>Bootstrap Page</title>\n    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">\n  </head>\n  <body>\n    <div class="container">\n      <h1>Hello, Bootstrap!</h1>\n    </div>\n    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"><\/script>\n  </body>\n</html>', 'body { padding: 20px; }', ""); });

        // --- Initial Load ---
        loadHistory();
        const lastSnippet = (JSON.parse(localStorage.getItem('codeHistory')) || [])[0];
        if (lastSnippet) loadTemplate(lastSnippet.html, lastSnippet.css, lastSnippet.js);
        else document.getElementById('basicHtmlTemplate').click();
    });
    </script>
</body>
</html>