<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Compact HTML Tester</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        body {
            font-family: Arial, sans-serif;
            margin: 0;
            padding: 0;
            display: flex;
            flex-direction: column;
            align-items: center;
            background-color: #f0f2f5;
        }
        .main-container {
            width: 100%;
            max-width: 800px;
            padding: 15px;
            box-sizing: border-box;
            display: flex;
            flex-direction: column;
            gap: 15px;
        }
        .editor-section, .history-section {
            background-color: #fff;
            padding: 15px;
            border-radius: 8px;
            box-shadow: 0 4px 8px rgba(0,0,0,0.1);
        }
        textarea {
            width: 100%;
            height: 200px;
            padding: 10px;
            border: 1px solid #ccc;
            border-radius: 5px;
            resize: none;
            box-sizing: border-box;
            font-size: 16px;
        }
        .button-group {
            display: flex;
            justify-content: space-between;
            margin-top: 10px;
            gap: 10px;
        }
        button {
            flex: 1;
            padding: 10px 15px;
            border: none;
            border-radius: 5px;
            cursor: pointer;
            font-size: 14px;
            color: white;
            transition: background-color 0.2s ease;
        }
        #pasteBtn { background-color: #007bff; }
        #removeBtn { background-color: #dc3545; }
        #testBtn { background-color: #28a745; }
        #pasteBtn:hover { background-color: #0056b3; }
        #removeBtn:hover { background-color: #c82333; }
        #testBtn:hover { background-color: #218838; }

        .history-list {
            list-style-type: none;
            padding: 0;
            display: flex;
            flex-direction: column;
            gap: 10px;
        }
        .history-item {
            background-color: #f8f9fa;
            padding: 10px;
            border-radius: 5px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            border: 1px solid #e9ecef;
        }
        .history-item span {
            cursor: pointer;
            flex-grow: 1;
            overflow: hidden;
            text-overflow: ellipsis;
            white-space: nowrap;
            color: #495057;
        }
        .history-buttons {
            display: flex;
            gap: 5px;
        }
        .history-buttons button {
            flex: none;
            padding: 8px 10px;
            font-size: 12px;
        }
        .history-buttons .download-btn { background-color: #17a2b8; }
        .history-buttons .edit-btn { background-color: #ffc107; }
        .history-buttons .remove-btn { background-color: #dc3545; }
    </style>
</head>
<body>
    <div class="main-container">
        <h1>HTML Tester</h1>
        
        <div class="editor-section">
            <textarea id="htmlCode" placeholder="Paste your HTML code here..."></textarea>
            <div class="button-group">
                <button id="pasteBtn">Paste</button>
                <button id="removeBtn">Remove</button>
                <button id="testBtn">Test</button>
            </div>
        </div>
        
        <div class="history-section">
            <h2>Saved HTML History</h2>
            <ul id="historyList" class="history-list">
                </ul>
        </div>
    </div>

    <script>
        const htmlCodeTextarea = document.getElementById('htmlCode');
        const pasteBtn = document.getElementById('pasteBtn');
        const removeBtn = document.getElementById('removeBtn');
        const testBtn = document.getElementById('testBtn');
        const historyList = document.getElementById('historyList');

        // Function to extract title from HTML
        function getTitleFromHtml(html) {
            const match = html.match(/<title>(.*?)<\/title>/i);
            return match && match[1] ? match[1] : 'Untitled';
        }

        // Function to load history from local storage
        function loadHistory() {
            const savedHistory = JSON.parse(localStorage.getItem('htmlHistory')) || [];
            historyList.innerHTML = '';
            savedHistory.forEach((item, index) => {
                const listItem = document.createElement('li');
                listItem.classList.add('history-item');
                
                const codeSpan = document.createElement('span');
                codeSpan.textContent = item.title;
                
                const buttonContainer = document.createElement('div');
                buttonContainer.classList.add('history-buttons');

                const editBtn = document.createElement('button');
                editBtn.classList.add('edit-btn');
                editBtn.innerHTML = '<i class="fas fa-edit"></i>';
                editBtn.title = 'Edit HTML';
                editBtn.onclick = () => {
                    htmlCodeTextarea.value = item.code;
                    // Scroll to the top of the page to see the editor
                    window.scrollTo({ top: 0, behavior: 'smooth' });
                };

                const downloadBtn = document.createElement('button');
                downloadBtn.classList.add('download-btn');
                downloadBtn.innerHTML = '<i class="fas fa-download"></i>';
                downloadBtn.title = 'Download as index.html';
                downloadBtn.onclick = () => downloadCode(item.code);

                const removeBtn = document.createElement('button');
                removeBtn.classList.add('remove-btn');
                removeBtn.innerHTML = '<i class="fas fa-trash-alt"></i>';
                removeBtn.title = 'Remove from history';
                removeBtn.onclick = () => {
                    removeCode(index);
                };

                buttonContainer.appendChild(editBtn);
                buttonContainer.appendChild(downloadBtn);
                buttonContainer.appendChild(removeBtn);

                listItem.appendChild(codeSpan);
                listItem.appendChild(buttonContainer);
                historyList.appendChild(listItem);
            });
        }

        // Function to remove a code entry from history
        function removeCode(indexToRemove) {
            let savedHistory = JSON.parse(localStorage.getItem('htmlHistory')) || [];
            savedHistory.splice(indexToRemove, 1);
            localStorage.setItem('htmlHistory', JSON.stringify(savedHistory));
            loadHistory();
        }

        // Function to save code to local storage
        function saveCode(html) {
            const savedHistory = JSON.parse(localStorage.getItem('htmlHistory')) || [];
            const title = getTitleFromHtml(html);
            savedHistory.unshift({ code: html, title: title }); 
            localStorage.setItem('htmlHistory', JSON.stringify(savedHistory.slice(0, 10)));
            loadHistory();
        }
        
        // Function to download the code
        function downloadCode(html) {
            const a = document.createElement('a');
            const file = new Blob([html], { type: 'text/html' });
            a.href = URL.createObjectURL(file);
            a.download = 'index.html';
            a.click();
        }

        // Function to handle the test button logic
        function testHtmlCode() {
            const code = htmlCodeTextarea.value;
            if (code) {
                saveCode(code); // Save code to history
                
                const newWindow = window.open('', '_blank', 'width=800,height=600');
                if (newWindow) {
                    newWindow.document.open();
                    newWindow.document.write(`
                        <!DOCTYPE html>
                        <html>
                        <head>
                            <meta charset="UTF-8">
                            <meta name="viewport" content="width=device-width, initial-scale=1.0">
                            <title>Preview</title>
                            <style>
                                body {
                                    font-family: Arial, sans-serif;
                                    margin: 0;
                                }
                                #toggleViewBtn {
                                    position: fixed;
                                    bottom: 20px;
                                    right: 20px;
                                    padding: 10px 15px;
                                    border: none;
                                    border-radius: 5px;
                                    background-color: #007bff;
                                    color: white;
                                    cursor: pointer;
                                    z-index: 1000;
                                }
                                body.desktop-view {
                                    width: 1024px;
                                    margin: 0 auto;
                                    border: 1px solid #ccc;
                                    box-shadow: 0 0 10px rgba(0,0,0,0.1);
                                }
                            </style>
                        </head>
                        <body>
                            ${code}
                            <button id="toggleViewBtn">Switch to Desktop View</button>
                            <script>
                                const toggleViewBtn = document.getElementById('toggleViewBtn');
                                toggleViewBtn.addEventListener('click', () => {
                                    document.body.classList.toggle('desktop-view');
                                    if (document.body.classList.contains('desktop-view')) {
                                        toggleViewBtn.textContent = 'Switch to Mobile View';
                                    } else {
                                        toggleViewBtn.textContent = 'Switch to Desktop View';
                                    }
                                });
                            <\/script>
                        </body>
                        </html>
                    `);
                    newWindow.document.close();
                }
            }
        }

        // Event Listeners
        pasteBtn.addEventListener('click', async () => {
            try {
                const text = await navigator.clipboard.readText();
                htmlCodeTextarea.value = text;
            } catch (err) {
                console.error('Failed to read clipboard contents: ', err);
            }
        });

        removeBtn.addEventListener('click', () => {
            htmlCodeTextarea.value = '';
        });

        testBtn.addEventListener('click', testHtmlCode);

        // Load history and last saved code on page load
        window.addEventListener('load', () => {
            loadHistory();
            const lastCode = JSON.parse(localStorage.getItem('htmlHistory'));
            if (lastCode && lastCode[0]) {
                htmlCodeTextarea.value = lastCode[0].code;
            }
        });
    </script>
</body>
</html>
