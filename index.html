<!DOCTYPE html>
<html lang="hi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Mini HTML IDE</title>
    <style>
        :root {
            --bg-color: #f4f6f8; --pane-bg: #ffffff; --text-color: #212529;
            --subtle-text-color: #6c757d; --border-color: #dee2e6; --primary-color: #0d6efd;
            --info-color: #0dcaf0; --success-color: #198754; --danger-color: #dc3545;
            --editor-bg: #fafbfc; --shadow-color: rgba(0, 0, 0, 0.075); --hover-bg: #e9ecef;
        }
        body.dark-mode {
            --bg-color: #1a1d21; --pane-bg: #212529; --text-color: #e9ecef;
            --subtle-text-color: #adb5bd; --border-color: #495057; --primary-color: #3b82f6;
            --info-color: #22d3ee; --success-color: #4ade80; --danger-color: #f87171;
            --editor-bg: #2b3035; --shadow-color: rgba(0, 0, 0, 0.2); --hover-bg: #343a40;
        }
        * { box-sizing: border-box; margin: 0; padding: 0; }
        html { font-family: system-ui, -apple-system, sans-serif; }
        body { background-color: var(--bg-color); color: var(--text-color); padding: 1rem; }
        .container { display: flex; flex-direction: column; gap: 1.5rem; }

        /* FILE MANAGER */
        .file-manager-container {
            background-color: var(--pane-bg); border: 1px solid var(--border-color);
            border-radius: 8px; padding: 0.75rem; box-shadow: 0 4px 12px var(--shadow-color);
        }
        .fm-toolbar { display: flex; justify-content: space-between; align-items: center; margin-bottom: 0.75rem; }
        .path-display { font-family: monospace; color: var(--subtle-text-color); }
        .fm-actions button { background: none; border: 1px solid var(--border-color); border-radius: 6px; padding: 0.4rem 0.8rem; cursor: pointer; }
        #file-list { max-height: 40vh; overflow-y: auto; }
        .item { display: flex; justify-content: space-between; align-items: center; padding: 0.5rem; border-radius: 6px; }
        .item:hover { background-color: var(--hover-bg); }
        .item-name { display: flex; align-items: center; gap: 0.5rem; cursor: pointer; flex-grow: 1; }
        .item-actions { display: none; }
        .item:hover .item-actions { display: flex; gap: 0.5rem; }
        .action-btn { background: none; border: none; cursor: pointer; font-size: 1.1rem; color: var(--subtle-text-color); }
        
        /* EDITOR CONTROLS */
        .editor-controls {
            background-color: var(--pane-bg); border: 1px solid var(--border-color);
            border-radius: 8px; padding: 1rem; box-shadow: 0 4px 12px var(--shadow-color);
            display: flex; flex-direction: column; gap: 1rem;
        }
        .input-wrapper { display: flex; align-items: center; gap: 0.5rem; }
        #htmlCode {
            flex-grow: 1; border: 1px solid var(--border-color); padding: 0.5rem 0.75rem;
            font-family: monospace; font-size: 1rem; background-color: var(--editor-bg);
            color: var(--text-color); border-radius: 6px; resize: none; overflow: hidden; white-space: nowrap;
        }
        .input-btn {
            background: none; border: 1px solid var(--border-color); color: var(--text-color);
            border-radius: 6px; padding: 0.5rem 0.75rem; cursor: pointer; font-weight: 500;
        }
        #clearBtn { font-size: 1.2rem; padding: 0.25rem 0.75rem; color: var(--danger-color); }
        .button-group { display: flex; gap: 0.5rem; flex-wrap: wrap; }
        .button-group button { padding: 0.5rem 1rem; border: none; border-radius: 6px; font-weight: 500; cursor: pointer; color: white; }
        #testBtn { background-color: var(--primary-color); }
        #saveBtn { background-color: var(--success-color); }
        
        /* FULL SCREEN EDITOR MODAL */
        .modal-overlay {
            position: fixed; top: 0; left: 0; width: 100%; height: 100%;
            background-color: rgba(0, 0, 0, 0.7); display: none;
            align-items: center; justify-content: center; z-index: 1000; padding: 1rem;
        }
        .modal-content {
            background-color: var(--pane-bg); width: 100%; height: 100%;
            display: flex; flex-direction: column; gap: 1rem; padding: 1.5rem; border-radius: 8px;
        }
        .modal-content textarea {
            flex-grow: 1; resize: none; width: 100%; font-size: 1rem; color: var(--text-color);
            border: 1px solid var(--border-color); background-color: var(--editor-bg); padding: 1rem;
        }
        .modal-footer { text-align: right; }
    </style>
</head>
<body>

    <div class="container">
        <div class="file-manager-container">
            <div class="fm-toolbar">
                <span class="path-display" id="currentPathDisplay">/</span>
                <div class="fm-actions">
                    <button id="newFolderBtn">üìÅ+ ‡§®‡§Ø‡§æ ‡§´‡•ã‡§≤‡•ç‡§°‡§∞</button>
                    <button id="themeToggleBtn">‚òÄÔ∏è</button>
                </div>
            </div>
            <div id="file-list"></div>
        </div>

        <div class="editor-controls">
            <div class="input-wrapper">
                <textarea id="htmlCode" rows="1" placeholder="‡§ï‡•ã‡§° ‡§™‡•á‡§∏‡•ç‡§ü ‡§ï‡§∞‡•á‡§Ç ‡§Ø‡§æ ‡§´‡§æ‡§á‡§≤ ‡§è‡§°‡§ø‡§ü ‡§ï‡§∞‡•á‡§Ç..."></textarea>
                <button id="clearBtn" class="input-btn" title="Clear Text">√ó</button>
                <button id="editBtn" class="input-btn" title="Edit Full Screen">‡§è‡§°‡§ø‡§ü</button>
            </div>
            <div class="button-group">
                <button id="testBtn">üöÄ ‡§∞‡§® ‡§ï‡§∞‡•á‡§Ç</button>
                <button id="saveBtn">üíæ ‡§∏‡•á‡§µ ‡§ï‡§∞‡•á‡§Ç</button>
            </div>
        </div>
    </div>
    
    <div id="editorModal" class="modal-overlay">
        <div class="modal-content">
            <h2>Full Screen Editor</h2>
            <textarea id="fullScreenEditor"></textarea>
            <div class="modal-footer">
                <button id="doneEditingBtn" class="button-group" style="background-color: var(--success-color); color: white;">Done</button>
            </div>
        </div>
    </div>

    <script>
        document.addEventListener('DOMContentLoaded', () => {
            // --- STATE & DOM ELEMENTS ---
            let state = { fileSystem: { type: 'folder', name: 'root', children: {} }, currentPath: 'root', openFilePath: null };
            const elements = {
                codeEditor: document.getElementById('htmlCode'),
                fileList: document.getElementById('file-list'),
                newFolderBtn: document.getElementById('newFolderBtn'),
                currentPathDisplay: document.getElementById('currentPathDisplay'),
                themeToggleBtn: document.getElementById('themeToggleBtn'),
                clearBtn: document.getElementById('clearBtn'),
                editBtn: document.getElementById('editBtn'),
                testBtn: document.getElementById('testBtn'),
                saveBtn: document.getElementById('saveBtn'),
                editorModal: document.getElementById('editorModal'),
                fullScreenEditor: document.getElementById('fullScreenEditor'),
                doneEditingBtn: document.getElementById('doneEditingBtn'),
            };

            // --- STATE & UTILITY FUNCTIONS ---
            const loadState = () => {
                const savedState = localStorage.getItem('miniIdeState_v2');
                if (savedState) state = JSON.parse(savedState);
                if (!state.fileSystem) state.fileSystem = { type: 'folder', name: 'root', children: {} };
            };
            const saveState = () => localStorage.setItem('miniIdeState_v2', JSON.stringify(state));
            const getObjectByPath = (path) => {
                const parts = path.split('/').filter(p => p && p !== 'root');
                let current = state.fileSystem;
                for (const part of parts) {
                    if (current && current.children && current.children[part]) { current = current.children[part]; } 
                    else { return null; }
                }
                return current;
            };
            const previewCode = (code) => {
                const newWindow = window.open();
                newWindow.document.write(code);
                newWindow.document.close();
            };
            
            // --- EDITOR MODAL LOGIC ---
            elements.editBtn.addEventListener('click', () => {
                elements.fullScreenEditor.value = elements.codeEditor.value;
                elements.editorModal.style.display = 'flex';
                elements.fullScreenEditor.focus();
            });
            elements.doneEditingBtn.addEventListener('click', () => {
                elements.codeEditor.value = elements.fullScreenEditor.value;
                elements.editorModal.style.display = 'none';
            });
            elements.clearBtn.addEventListener('click', () => { elements.codeEditor.value = ''; state.openFilePath = null; });
            
            // --- FILE MANAGER RENDER ---
            const renderFileManager = () => {
                const currentFolder = getObjectByPath(state.currentPath);
                elements.fileList.innerHTML = '';
                
                if (state.currentPath !== 'root') {
                    const parentPath = state.currentPath.substring(0, state.currentPath.lastIndexOf('/'));
                    const upEl = document.createElement('div');
                    upEl.className = 'item';
                    upEl.innerHTML = `<div class="item-name">üìÅ .. (‡§ä‡§™‡§∞ ‡§ú‡§æ‡§è‡§Ç)</div>`;
                    upEl.addEventListener('click', () => { state.currentPath = parentPath || 'root'; renderFileManager(); });
                    elements.fileList.appendChild(upEl);
                }

                const items = Object.values(currentFolder.children).sort((a,b) => a.name.localeCompare(b.name)).sort((a,b) => a.type === 'folder' ? -1 : 1);

                items.forEach(item => {
                    const itemEl = document.createElement('div');
                    itemEl.className = 'item';
                    const itemPath = `${state.currentPath}/${item.name}`;
                    const isFolder = item.type === 'folder';

                    itemEl.innerHTML = `
                        <div class="item-name" data-path="${itemPath}">${isFolder ? 'üìÅ' : 'üìÑ'} ${item.name}</div>
                        <div class="item-actions">
                            ${!isFolder ? '<button class="action-btn edit-file-btn" title="‡§è‡§°‡§ø‡§ü ‡§ï‡§∞‡•á‡§Ç">‚úèÔ∏è</button>' : ''}
                            <button class="action-btn delete-item-btn" title="‡§°‡§ø‡§≤‡•Ä‡§ü ‡§ï‡§∞‡•á‡§Ç">üóëÔ∏è</button>
                        </div>
                    `;
                    elements.fileList.appendChild(itemEl);
                });
                
                elements.currentPathDisplay.textContent = `/${state.currentPath.replace('root', '').replace(/\//g, ' / ')}`;
            };
            
            // --- FILE MANAGER EVENT HANDLING ---
            elements.fileList.addEventListener('click', (e) => {
                const target = e.target;
                const itemEl = target.closest('.item');
                if (!itemEl) return;
                
                const nameEl = itemEl.querySelector('.item-name');
                const path = nameEl.dataset.path;
                const item = getObjectByPath(path);

                if (target.closest('.edit-file-btn')) {
                    state.openFilePath = path;
                    elements.codeEditor.value = item.content || '';
                } else if (target.closest('.delete-item-btn')) {
                    if (confirm(`'${item.name}' ‡§ï‡•ã ‡§°‡§ø‡§≤‡•Ä‡§ü ‡§ï‡§∞‡§®‡§æ ‡§ö‡§æ‡§π‡§§‡•á ‡§π‡•à‡§Ç?`)) {
                        const parentFolder = getObjectByPath(path.substring(0, path.lastIndexOf('/')));
                        delete parentFolder.children[item.name];
                        if (state.openFilePath === path) { state.openFilePath = null; elements.codeEditor.value = ''; }
                        saveState();
                        renderFileManager();
                    }
                } else if (target.closest('.item-name')) {
                    if (item.type === 'folder') {
                        state.currentPath = path;
                        renderFileManager();
                    } else {
                        previewCode(item.content);
                    }
                }
            });
            
            elements.newFolderBtn.addEventListener('click', () => {
                const folderName = prompt("‡§®‡§è ‡§´‡•ã‡§≤‡•ç‡§°‡§∞ ‡§ï‡§æ ‡§®‡§æ‡§Æ ‡§¨‡§§‡§æ‡§è‡§Ç:");
                if (folderName && folderName.trim()) {
                    const currentFolder = getObjectByPath(state.currentPath);
                    if (currentFolder.children[folderName]) {
                        alert("‡§á‡§∏ ‡§®‡§æ‡§Æ ‡§ï‡§æ ‡§´‡•ã‡§≤‡•ç‡§°‡§∞ ‡§™‡§π‡§≤‡•á ‡§∏‡•á ‡§Æ‡•å‡§ú‡•Ç‡§¶ ‡§π‡•à‡•§");
                        return;
                    }
                    currentFolder.children[folderName] = { type: 'folder', name: folderName, children: {} };
                    saveState();
                    renderFileManager();
                }
            });
            
            // --- MAIN ACTION BUTTONS ---
            elements.testBtn.addEventListener('click', () => previewCode(elements.codeEditor.value));
            
            elements.saveBtn.addEventListener('click', () => {
                let pathOfFile = state.openFilePath;
                const currentFolder = getObjectByPath(state.currentPath);

                if (pathOfFile) {
                    const fileToSave = getObjectByPath(pathOfFile);
                    fileToSave.content = elements.codeEditor.value;
                    alert(`'${fileToSave.name}' ‡§Ö‡§™‡§°‡•á‡§ü ‡§π‡•ã ‡§ó‡§Ø‡•Ä‡•§`);
                } else {
                    const fileName = prompt("‡§´‡§æ‡§á‡§≤ ‡§ï‡§æ ‡§®‡§æ‡§Æ ‡§¨‡§§‡§æ‡§è‡§Ç (‡§ú‡•à‡§∏‡•á: index.html):", "index.html");
                    if (!fileName || !fileName.trim()) return;

                    if (currentFolder.children[fileName]) {
                        if (!confirm("‡§Ø‡§π ‡§´‡§æ‡§á‡§≤ ‡§™‡§π‡§≤‡•á ‡§∏‡•á ‡§π‡•à‡•§ ‡§ï‡•ç‡§Ø‡§æ ‡§Ü‡§™ ‡§á‡§∏‡•á ‡§ì‡§µ‡§∞‡§∞‡§æ‡§á‡§ü ‡§ï‡§∞‡§®‡§æ ‡§ö‡§æ‡§π‡§§‡•á ‡§π‡•à‡§Ç?")) return;
                    }
                    
                    currentFolder.children[fileName] = { type: 'file', name: fileName, content: elements.codeEditor.value };
                    state.openFilePath = `${state.currentPath}/${fileName}`;
                    alert(`'${fileName}' ‡§∏‡•á‡§µ ‡§π‡•ã ‡§ó‡§Ø‡•Ä‡•§`);
                }
                saveState();
                renderFileManager();
            });

            elements.themeToggleBtn.addEventListener('click', () => {
                document.body.classList.toggle('dark-mode');
                elements.themeToggleBtn.textContent = document.body.classList.contains('dark-mode') ? 'üåô' : '‚òÄÔ∏è';
            });
            
            // --- INITIALIZATION ---
            loadState();
            renderFileManager();
        });
    </script>
</body>
</html>